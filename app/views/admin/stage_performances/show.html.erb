<% day       = @stage_performance.festival_day %>
<% festival  = day&.festival %>
<% stage     = @stage_performance.stage %>
<% artist    = @stage_performance.artist %>
<% time_zone = ActiveSupport::TimeZone[festival&.timezone] || Time.zone %>
<% starts_at = @stage_performance.starts_at&.in_time_zone(time_zone) %>
<% ends_at   = @stage_performance.ends_at&.in_time_zone(time_zone) %>
<% duration  = (starts_at && ends_at) ? ((ends_at - starts_at) / 60.0).round : nil %>

<div class="mx-auto max-w-4xl px-4 py-10 min-h-[calc(100vh-var(--header-offset,4.5rem)-var(--footer-offset,6rem))]">
  <div class="flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between">
    <div>
      <div class="flex items-center gap-3">
        <h1 class="text-2xl font-bold text-slate-900">出演枠詳細</h1>
        <% if @stage_performance.scheduled? %>
          <span class="inline-flex items-center rounded-full bg-emerald-100 px-3 py-1 text-xs font-semibold uppercase tracking-wide text-emerald-700">
            scheduled
          </span>
        <% else %>
          <span class="inline-flex items-center rounded-full bg-slate-100 px-3 py-1 text-xs font-semibold uppercase tracking-wide text-slate-700">
            draft
          </span>
        <% end %>
      </div>
      <p class="mt-2 text-sm text-slate-600">
        フェス・日程・出演者の詳細を確認できます。
      </p>
    </div>
    <div class="flex flex-wrap gap-2">
      <%= link_to "一覧に戻る",
            admin_stage_performances_path,
            class: "inline-flex items-center justify-center rounded-lg border border-slate-200 bg-white px-4 py-2 text-sm font-semibold text-slate-700 shadow-sm transition hover:bg-slate-50" %>
      <%= link_to "編集",
            edit_admin_stage_performance_path(@stage_performance),
            class: "inline-flex items-center justify-center rounded-lg bg-indigo-50 px-4 py-2 text-sm font-semibold text-indigo-700 transition hover:bg-indigo-100" %>
      <%= link_to "削除",
            admin_stage_performance_path(@stage_performance),
            data: { turbo_method: :delete, turbo_confirm: "削除しますか？" },
            class: "inline-flex items-center justify-center rounded-lg bg-rose-50 px-4 py-2 text-sm font-semibold text-rose-700 transition hover:bg-rose-100" %>
    </div>
  </div>

  <div class="mt-10 space-y-10">
    <section>
      <h2 class="text-lg font-semibold text-slate-800">基本情報</h2>
      <div class="mt-4 overflow-hidden rounded-xl border border-slate-200 bg-white shadow-sm">
        <dl class="divide-y divide-slate-100 text-sm text-slate-700">
          <div class="grid grid-cols-1 gap-2 px-4 py-3 sm:grid-cols-3">
            <dt class="font-semibold text-slate-500">フェス</dt>
            <dd class="sm:col-span-2">
              <% if festival.present? %>
                <%= link_to festival.name,
                      admin_festival_path(festival),
                      class: "text-indigo-600 hover:underline" %>
                <div class="text-xs text-slate-500">ID: <span class="font-mono"><%= festival.id %></span></div>
              <% else %>
                -
              <% end %>
            </dd>
          </div>
          <div class="grid grid-cols-1 gap-2 px-4 py-3 sm:grid-cols-3">
            <dt class="font-semibold text-slate-500">日付</dt>
            <dd class="sm:col-span-2">
              <% if day&.date.present? %>
                <%= day.date.strftime("%Y/%m/%d (%a)") %>
              <% else %>
                -
              <% end %>
            </dd>
          </div>
          <div class="grid grid-cols-1 gap-2 px-4 py-3 sm:grid-cols-3">
            <dt class="font-semibold text-slate-500">アーティスト</dt>
            <dd class="sm:col-span-2">
              <% if artist.present? %>
                <%= link_to artist.name,
                      admin_artist_path(artist),
                      class: "text-slate-900 hover:underline" %>
              <% else %>
                -
              <% end %>
            </dd>
          </div>
          <div class="grid grid-cols-1 gap-2 px-4 py-3 sm:grid-cols-3">
            <dt class="font-semibold text-slate-500">ステージ</dt>
            <dd class="sm:col-span-2">
              <% if stage.present? %>
                <span class="text-slate-900"><%= stage.name %></span>
                <% if stage.color_key.present? %>
                  <span class="ml-2 inline-flex items-center gap-1 rounded-full px-2 py-0.5 text-xs font-semibold"
                        style="background-color: <%= stage.color_hex %>; color: <%= stage_text_color(stage.color_hex) %>;">
                    <span><%= stage.color_key %></span>
                  </span>
                <% end %>
              <% else %>
                (未定)
              <% end %>
            </dd>
          </div>
          <div class="grid grid-cols-1 gap-2 px-4 py-3 sm:grid-cols-3">
            <dt class="font-semibold text-slate-500">状態</dt>
            <dd class="sm:col-span-2">
              <% if @stage_performance.scheduled? %>
                <span class="inline-flex items-center rounded-full bg-emerald-100 px-2.5 py-0.5 text-xs font-semibold text-emerald-700">scheduled</span>
              <% else %>
                <span class="inline-flex items-center rounded-full bg-slate-100 px-2.5 py-0.5 text-xs font-semibold text-slate-700">draft</span>
              <% end %>
            </dd>
          </div>
        </dl>
      </div>
    </section>

    <section>
      <h2 class="text-lg font-semibold text-slate-800">スケジュール</h2>
      <div class="mt-4 overflow-hidden rounded-xl border border-slate-200 bg-white shadow-sm">
        <dl class="divide-y divide-slate-100 text-sm text-slate-700">
          <div class="grid grid-cols-1 gap-2 px-4 py-3 sm:grid-cols-3">
            <dt class="font-semibold text-slate-500">開始</dt>
            <dd class="sm:col-span-2">
              <%= starts_at ? starts_at.strftime("%Y/%m/%d %H:%M") : "-" %>
            </dd>
          </div>
          <div class="grid grid-cols-1 gap-2 px-4 py-3 sm:grid-cols-3">
            <dt class="font-semibold text-slate-500">終了</dt>
            <dd class="sm:col-span-2">
              <%= ends_at ? ends_at.strftime("%Y/%m/%d %H:%M") : "-" %>
            </dd>
          </div>
          <div class="grid grid-cols-1 gap-2 px-4 py-3 sm:grid-cols-3">
            <dt class="font-semibold text-slate-500">所要時間</dt>
            <dd class="sm:col-span-2">
              <%= duration ? "#{duration.to_i} 分" : "-" %>
            </dd>
          </div>
          <div class="grid grid-cols-1 gap-2 px-4 py-3 sm:grid-cols-3">
            <dt class="font-semibold text-slate-500">タイムゾーン</dt>
            <dd class="sm:col-span-2">
              <span class="inline-flex items-center rounded-full bg-slate-100 px-2.5 py-0.5 text-xs font-semibold text-slate-700">
                <%= festival&.timezone || time_zone.tzinfo.name %>
              </span>
            </dd>
          </div>
        </dl>
      </div>
    </section>

    <section>
      <h2 class="text-lg font-semibold text-slate-800">メタ情報</h2>
      <div class="mt-4 overflow-hidden rounded-xl border border-slate-200 bg-white shadow-sm">
        <dl class="divide-y divide-slate-100 text-xs text-slate-600">
          <div class="grid grid-cols-1 gap-2 px-4 py-3 sm:grid-cols-3">
            <dt class="font-semibold uppercase tracking-wide text-slate-500">ID</dt>
            <dd class="sm:col-span-2 font-mono text-sm text-slate-700"><%= @stage_performance.id %></dd>
          </div>
          <div class="grid grid-cols-1 gap-2 px-4 py-3 sm:grid-cols-3">
            <dt class="font-semibold uppercase tracking-wide text-slate-500">作成日時</dt>
            <dd class="sm:col-span-2"><%= l(@stage_performance.created_at, format: :long) %></dd>
          </div>
          <div class="grid grid-cols-1 gap-2 px-4 py-3 sm:grid-cols-3">
            <dt class="font-semibold uppercase tracking-wide text-slate-500">更新日時</dt>
            <dd class="sm:col-span-2"><%= l(@stage_performance.updated_at, format: :long) %></dd>
          </div>
        </dl>
      </div>
    </section>
  </div>
</div>
