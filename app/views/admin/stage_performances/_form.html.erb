<% stage_performance = local_assigns.fetch(:stage_performance, @stage_performance) %>

<%= form_with model: [:admin, stage_performance], class: "space-y-6" do |f| %>
  <div class="rounded-xl border border-slate-200 bg-white p-6 shadow-sm space-y-6">
    <div class="grid grid-cols-1 gap-6 md:grid-cols-2">
      <div>
        <%= f.label :festival_day_id, "日程", class: "block text-sm font-semibold text-slate-700" %>
        <%= f.collection_select :festival_day_id,
              FestivalDay.includes(:festival).order(:date),
              :id,
              ->(d) { "#{d.festival.name} / #{d.date.strftime('%Y/%m/%d')}" },
              {},
              class: "mt-2 w-full rounded border border-slate-300 px-3 py-2 text-sm shadow-sm focus:border-indigo-400 focus:outline-none focus:ring-2 focus:ring-indigo-200" %>
      </div>
      <div>
        <%= f.label :artist_id, "アーティスト", class: "block text-sm font-semibold text-slate-700" %>
        <%= f.collection_select :artist_id,
              Artist.order(:name),
              :id,
              :name,
              {},
              class: "mt-2 w-full rounded border border-slate-300 px-3 py-2 text-sm shadow-sm focus:border-indigo-400 focus:outline-none focus:ring-2 focus:ring-indigo-200" %>
      </div>
    </div>

    <div>
      <%= f.label :stage_id, "ステージ（確定時）", class: "block text-sm font-semibold text-slate-700" %>
      <%= f.collection_select :stage_id,
            Stage.order(:sort_order, :id),
            :id,
            :name,
            { include_blank: "(未定)" },
            class: "mt-2 w-full rounded border border-slate-300 px-3 py-2 text-sm shadow-sm focus:border-indigo-400 focus:outline-none focus:ring-2 focus:ring-indigo-200" %>
      <p class="mt-2 text-xs text-slate-500">status が scheduled の場合は必須です。</p>
    </div>

    <div class="grid grid-cols-1 gap-6 md:grid-cols-2">
      <div>
        <%= f.label :starts_at, "開始", class: "block text-sm font-semibold text-slate-700" %>
        <%= f.datetime_local_field :starts_at,
              class: "mt-2 w-full rounded border border-slate-300 px-3 py-2 text-sm shadow-sm focus:border-indigo-400 focus:outline-none focus:ring-2 focus:ring-indigo-200" %>
      </div>
      <div>
        <%= f.label :ends_at, "終了", class: "block text-sm font-semibold text-slate-700" %>
        <%= f.datetime_local_field :ends_at,
              class: "mt-2 w-full rounded border border-slate-300 px-3 py-2 text-sm shadow-sm focus:border-indigo-400 focus:outline-none focus:ring-2 focus:ring-indigo-200" %>
      </div>
    </div>

    <div>
      <%= f.label :status, "状態", class: "block text-sm font-semibold text-slate-700" %>
      <%= f.select :status,
            StagePerformance.statuses.keys.map { |k| [k, k] },
            {},
            class: "mt-2 w-full rounded border border-slate-300 px-3 py-2 text-sm shadow-sm focus:border-indigo-400 focus:outline-none focus:ring-2 focus:ring-indigo-200" %>
      <p class="mt-2 text-xs text-slate-500">
        draft=出演者のみ登録 / scheduled=タイムテーブル確定（時間・ステージ必須）
      </p>
    </div>
  </div>

  <div class="pt-2">
    <%= f.submit class: "inline-flex items-center rounded bg-[#F95858] px-5 py-2 text-sm font-semibold text-white shadow transition hover:bg-[#e04f4f]" %>
  </div>
<% end %>
