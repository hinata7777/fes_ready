<%= form_with model: [:admin, @song], class: "space-y-6", data: { controller: "spotify-song-search" } do |f| %>
  <% if @song.errors.any? %>
    <div class="rounded border border-rose-200 bg-rose-50 px-4 py-3 text-rose-700">
      <div class="font-semibold mb-2"><%= pluralize(@song.errors.count, "error") %> prohibited this song from being saved:</div>
      <ul class="list-disc pl-5 text-sm">
        <% @song.errors.full_messages.each do |msg| %>
          <li><%= msg %></li>
        <% end %>
      </ul>
    </div>
  <% end %>

  <div class="border rounded-md p-4">
    <label class="block font-semibold mb-1">Spotifyで曲を検索</label>
    <div class="flex flex-col gap-2 sm:flex-row">
      <input type="text"
             placeholder="曲名で検索"
             class="w-full border rounded px-3 py-2 bg-white"
             data-spotify-song-search-target="query"
             data-action="keydown.enter->spotify-song-search#onSearch" />
      <button type="button"
              class="sm:w-auto px-4 py-2 rounded bg-slate-800 text-white shadow-sm interactive-lift hover:bg-slate-900"
              data-action="click->spotify-song-search#onSearch"
              data-controller="tap-feedback">
        Search
      </button>
    </div>
    <p class="text-xs text-slate-500 mt-2">最大10件を表示します。</p>

    <div class="mt-3 border rounded divide-y hidden bg-white"
         data-spotify-song-search-target="results"></div>
  </div>

  <div class="grid grid-cols-1 md:grid-cols-2 gap-4 items-start">
    <div>
      <%= f.label :name, "曲名", class: "block font-semibold" %>
      <%= f.text_field :name, class: "w-full border rounded px-3 py-2", data: { "spotify-song-search-target": "name" } %>
    </div>
    <div>
      <%= f.label :spotify_id, "Spotify Track ID（自動入力）", class: "block font-semibold" %>
      <%= f.text_field :spotify_id, class: "w-full border rounded px-3 py-2 bg-slate-100", readonly: true, data: { "spotify-song-search-target": "spotifyId" } %>
      <p class="text-xs text-slate-500 mt-1">空でも登録可能です。Spotifyでヒットしない楽曲は空のままにしてください。</p>
    </div>
  </div>

  <div>
    <%= f.label :artist_id, "アーティスト", class: "block font-semibold" %>
    <%= f.select :artist_id,
          options_for_select(@artists.map { |a| [a.name, a.id, { data: { spotify_id: a.spotify_artist_id } }] }, @song.artist_id),
          {},
          class: "mt-2 w-full rounded border border-slate-300 px-3 py-2 text-sm shadow-sm focus:border-indigo-400 focus:outline-none focus:ring-2 focus:ring-indigo-200",
          data: { "spotify-song-search-target": "artistSelect" } %>
    <p class="text-xs text-slate-500 mt-1">Spotify検索結果のアーティストIDが一致する場合は自動で選択されます。</p>
  </div>

  <div class="pt-4">
    <%= f.submit "登録する", class: "px-4 py-2 rounded bg-[#F95858] text-white shadow-sm interactive-lift hover:bg-[#e14f4f] focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-[#F95858]", data: { controller: "tap-feedback" } %>
  </div>
<% end %>
