<section class="mb-6" data-controller="toggle">
  <button type="button"
          class="flex w-full items-center justify-between rounded-lg px-1 py-2 text-left text-sm font-semibold text-slate-800 transition hover:text-indigo-600 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-400"
          data-action="click->toggle#toggle">
    <span class="flex items-center gap-2">
      <span data-toggle-target="showLabel">＋ 条件を指定して検索する</span>
      <span data-toggle-target="hideLabel" class="hidden">ー 条件を隠す</span>
    </span>
  </button>

  <div class="mt-3 hidden" data-toggle-target="panel">
    <div class="rounded-2xl border border-slate-200 bg-white p-4 shadow-sm">
      <%= form_with url: form_url, method: :get, local: true do |f| %>
        <%= hidden_field_tag(:status, status) %>
        <% if search_query.present? %>
          <%= hidden_field_tag("q[name_i_cont]", search_query) %>
        <% end %>

        <div class="space-y-4">
          <div class="grid gap-4 sm:grid-cols-2">
            <div class="space-y-2">
              <label for="start_date_from" class="text-sm font-semibold text-slate-800">開催開始日</label>
              <%= date_field_tag :start_date_from,
                                 filter_params[:start_date_from],
                                 class: "w-full rounded-lg border border-slate-300 px-3 py-2 text-sm text-slate-800 shadow-sm focus:border-indigo-400 focus:outline-none focus:ring-2 focus:ring-indigo-100" %>
            </div>
            <div class="space-y-2">
              <label for="end_date_to" class="text-sm font-semibold text-slate-800">開催終了日</label>
              <%= date_field_tag :end_date_to,
                                 filter_params[:end_date_to],
                                 class: "w-full rounded-lg border border-slate-300 px-3 py-2 text-sm text-slate-800 shadow-sm focus:border-indigo-400 focus:outline-none focus:ring-2 focus:ring-indigo-100" %>
            </div>
          </div>

          <div class="space-y-2">
            <label for="area" class="text-sm font-semibold text-slate-800">開催地域</label>
            <%= select_tag :area,
                           options_for_select([["エリアを選択", ""]] + Regions::AREA_PREFECTURES.keys.map { |area| [area, area] }, filter_params[:area]),
                           class: "w-full rounded-lg border border-slate-300 bg-white px-3 py-2 text-sm text-slate-800 shadow-sm focus:border-indigo-400 focus:outline-none focus:ring-2 focus:ring-indigo-100" %>
          </div>

          <div class="space-y-2">
            <div class="flex items-center justify-between">
              <label class="text-sm font-semibold text-slate-800">タグ</label>
              <span class="text-xs font-semibold text-slate-500">複数選択可</span>
            </div>
            <div class="flex flex-wrap gap-2">
              <% festival_tags.each do |tag| %>
                <% checked = selected_tag_ids.include?(tag.id) %>
                <label class="inline-flex items-center gap-2">
                  <%= check_box_tag "tag_ids[]",
                                    tag.id,
                                    checked,
                                    class: "peer sr-only" %>
                  <span class="rounded-full border border-slate-300 px-3 py-1.5 text-xs font-semibold text-slate-700 shadow-sm transition hover:border-indigo-300 hover:text-indigo-700 peer-checked:border-indigo-400 peer-checked:bg-indigo-50 peer-checked:text-indigo-700">
                    <%= tag.name %>
                  </span>
                </label>
              <% end %>
            </div>
          </div>

          <div class="flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-end">
            <%= link_to "リセット",
                        reset_url,
                        class: "inline-flex items-center justify-center rounded-lg border border-slate-300 px-4 py-2 text-sm font-semibold text-slate-700 shadow-sm transition hover:bg-slate-50 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-slate-400" %>
            <%= f.submit "条件で検索",
                         class: "inline-flex items-center justify-center rounded-lg bg-indigo-500 px-5 py-2 text-sm font-semibold text-white shadow-sm transition hover:bg-indigo-400 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-400" %>
          </div>
        </div>
      <% end %>
    </div>
  </div>
</section>
